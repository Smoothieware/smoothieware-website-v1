# strange problem with g28 command

*Original post date: 2016-01-01*

---

导师：嗯，用户之前在论坛上讨论了关于3D打印机G28指令的问题，现在他们可能需要进一步的帮助。用户之前提到调整了快速移动速度，但问题可能没有完全解决。我需要先回顾之前的对话，确保理解用户的具体情况。

用户可能在使用Marlin固件的3D打印机，遇到了G28指令执行时的异常，比如轴卡顿或不移动。之前建议检查电机驱动、步进电机、导轨和皮带，但用户可能已经尝试过这些步骤，问题仍未解决。现在用户可能需要更深入的解决方案，比如固件设置调整或硬件检查。

用户可能没有明确说明当前的设置或错误信息，所以需要进一步询问。例如，是否有错误代码？电机是否发热？是否有其他轴出现问题？此外，用户可能对固件配置不熟悉，需要指导如何调整相关参数，如MAX_FEEDRATE或加速度设置。

另外，用户可能希望了解如何诊断电机驱动的问题，比如检查驱动器的电流设置是否正确，或者是否有短路现象。也有可能需要建议用户进行更详细的测试，比如单独测试每个轴的运动，排除机械故障。

最后，用户可能需要确认是否正确执行了G28指令，或者是否有其他G代码冲突。需要确保用户理解G28的作用是归位，而不仅仅是移动，可能涉及限位开关的状态。如果限位开关有问题，可能导致归位失败。因此，需要引导用户检查限位开关的连接和功能。
</think>

根据你的描述，关于3D打印机G28指令的问题，以下是分步解决方案和建议：

---

### **1. 确认问题现象**
请先明确以下几点：
- **G28执行时的具体表现**：轴是否完全不动？还是移动不顺畅？是否有异常噪音？
- **是否所有轴都受影响**？还是仅某个轴（如X/Y/Z）？
- **是否有错误提示**？例如固件报错（如“Endstop hit”或“Motor stall”）？
- **是否仅在G28时发生**？还是其他G代码（如G0/G1）也存在问题？

---

### **2. 检查硬件连接**
#### **(1) 限位开关（Endstop）**
- **检查物理连接**：确保限位开关的接线正确（通常为GND、信号线、VCC），无松动或短路。
- **测试限位开关功能**：
  - 手动按下限位开关，观察打印机是否能正确识别（如控制面板或软件显示“Homed”）。
  - 若限位开关损坏，需更换（常见于老款打印机）。

#### **(2) 电机和驱动器**
- **电机是否正常**：
  - 检查电机是否卡死或异响（可能因导轨/皮带过紧、电机老化）。
  - 用万用表测量电机电阻（通常为1.5-3Ω/相，不平衡可能损坏电机）。
- **驱动器设置**：
  - 检查驱动器电流设置是否匹配电机规格（如TMC2209驱动器的电流调节旋钮）。
  - 观察驱动器是否有过热（可能因电流过高或散热不良）。

#### **(3) 机械结构**
- **导轨和皮带**：
  - 检查导轨是否清洁、润滑（积尘可能导致卡顿）。
  - 皮带是否过紧或磨损（松动会导致定位不准，过紧会增加电机负载）。
- **同步轮**：
  - 检查同步轮是否磨损或错位（可能导致电机空转）。

---

### **3. 固件设置调整**
如果硬件无问题，可能是固件参数设置不当：

#### **(1) 调整快速移动速度（MAX_FEEDRATE）**
- 在`Configuration.h`中检查以下参数：
  ```cpp
  #define DEFAULT_AXIS_PULSE_WIDTH 1000 // 脉冲宽度（单位：μs）
  #define DEFAULT_MAX_FEEDRATE {100, 100, 4} // X, Y, Z轴最大速度（mm/s）
  ```
- **建议**：将`MAX_FEEDRATE`降低至50-80 mm/s（Z轴可更低），观察是否改善。

#### **(2) 加速度和加加速度**
- 调整加速度参数（`MAX_ACCELERATION`）：
  ```cpp
  #define DEFAULT_MAX_ACCELERATION {9000, 9000, 1000} // X, Y, Z轴加速度（mm/s²）
  ```
- **建议**：降低至5000-7000 mm/s²，避免电机过载。

#### **(3) 限位开关回退距离**
- 检查`ENDSTOP_OFFSET`设置（部分固件支持）：
  ```cpp
  #define ENDSTOP_OFFSET {0, 0, 0} // X, Y, Z轴回退距离（mm）
  ```
- **建议**：若限位开关未完全触发，可尝试增加回退距离（如`{0.5, 0.5, 0.5}`）。

---

### **4. 进阶诊断**
#### **(1) 使用M122诊断电机状态**
- 在打印机控制界面发送`M122`，查看电机电流、温度等信息。
- 若出现“Motor stall”提示，需降低速度或检查电机驱动。

#### **(2) 单轴测试**
- 通过G代码单独测试每个轴：
  ```gcode
  G91 ; 相对坐标
  G1 X10 F1000 ; 仅移动X轴
  G90 ; 绝对坐标
  ```
- 若某轴无法移动，问题可能出在该轴的电机/驱动/机械。

#### **(3) 固件升级**
- 确认是否使用最新固件版本（如Marlin 2.0.x）。
- 部分旧版本固件可能存在G28指令的Bug。

---

### **5. 其他可能原因**
- **电源问题**：检查电源电压是否稳定（建议使用原装电源）。
- **固件配置冲突**：检查是否有自定义宏或插件干扰G28指令。
- **限位开关拉绳**：部分打印机使用拉绳式限位开关，需确认拉绳未被卡住。

---

### **6. 总结步骤**
1. **检查限位开关和电机驱动** → 2. **调整固件参数** → 3. **单轴测试** → 4. **升级固件** → 5. **联系技术支持**（如问题仍未解决）。

如果以上步骤仍无法解决，请提供以下信息以便进一步分析：
- 打印机型号和固件版本
- 具体错误提示（如有）
- 电机驱动型号和电流设置
- 是否更换过硬件（如电机、导轨等）

---

*This post was archived from the old Smoothieware forum.*
*Source: [Wayback Machine](https://web.archive.org/web/20150730052647/http://smoothieware.org/forum/t-1060186/strange-problem-with-g28-command)*
