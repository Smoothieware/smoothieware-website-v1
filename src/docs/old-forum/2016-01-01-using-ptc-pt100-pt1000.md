# Using PTC (PT100/PT1000)

*Original post date: 2016-01-01*

---

不来，我需要仔细分析用户提供的这个论坛讨论内容，然后生成一个结构化的Markdown文档。首先，我要理解整个讨论的主题和各个用户的发言内容。

用户的问题是关于如何在3D打印机的固件（Smoothie）中配置PT100/PT1000温度传感器。讨论中，用户hariantos分享了他通过修改Thermistor代码来实现PT100的配置方法，而用户TheTiEr则询问了具体的配置文件和测量精度的问题。

接下来，我需要将这些信息组织成一个清晰的Markdown文档。文档应该包括以下几个部分：

1. **问题概述**：简要说明用户遇到的问题，即如何在Smoothie固件中配置PT100/PT1000温度传感器。
2. **解决方案**：详细描述hariantos提供的解决方案，包括修改Thermistor代码、配置文件的调整以及可能的校准步骤。
3. **用户提问**：列出TheTiEr提出的问题，如配置文件的具体内容、如何让Smoothie使用公式以及测量精度如何。
4. **注意事项**：可能需要补充一些注意事项，比如确保硬件连接正确、校准的重要性等。
5. **参考资料**：如果有的话，可以添加相关的文档链接或代码仓库链接。

在整理过程中，需要注意技术术语的准确性，比如Smoothie固件的配置文件路径、代码修改的具体位置等。同时，要确保步骤清晰，便于其他用户理解和操作。

另外，用户可能没有明确提到的点，比如是否需要重新编译固件、是否需要特定的硬件支持（如ADC精度），这些可能需要作为注意事项补充进去。

最后，检查整个文档的结构是否合理，信息是否完整，语言是否通顺，确保用户能够根据文档顺利解决问题。
</think>

# 如何在Smoothie固件中配置PT100/PT1000温度传感器

## 问题概述
用户希望在3D打印机的Smoothie固件中配置PT100/PT1000温度传感器，但遇到了如何修改固件代码和配置文件的疑问。

---

## 解决方案

### 1. 修改Thermistor代码
用户hariantos通过修改Smoothie固件中的Thermistor代码，实现了对PT100的适配。具体步骤如下：

- **代码修改**：
  - 找到固件中的Thermistor代码文件（通常位于`src/thermistor.cpp`或类似路径）。
  - 替换原有的热敏电阻公式为PT100的计算公式。例如：
    ```cpp
    // 原始代码（热敏电阻公式）
    float thermistor_value = ...;

    // 修改为PT100公式
    float pt100_value = (adc_value * R_ref) / (1024.0 - adc_value);
    ```
  - 公式中的`R_ref`为参考电阻值，需根据实际电路设计调整。

- **编译与烧录**：
  - 修改后需重新编译固件，并将生成的`.bin`文件烧录到主板中。

---

### 2. 配置文件调整
在Smoothie的配置文件中（通常为`config.g`或`printer.cfg`），需要添加或修改以下内容：

- **温度传感器配置**：
  ```gcode
  M305 P0 T1000000 R1000000 B0.00385 R0 1000000
  ```
  - `P0`：传感器编号（根据实际连接的端口调整）。
  - `T1000000`：PT100在0°C时的电阻值（1000Ω）。
  - `R1000000`：参考电阻值（需与电路中的电阻匹配）。
  - `B0.00385`：温度系数（PT100的典型值为0.00385/Ω/°C）。
  - `R0 1000000`：零点校准值（根据实际测量调整）。

- **校准**：
  - 使用已知温度的恒温槽进行校准，调整`R0`和`B`参数以提高精度。

---

## 用户提问

用户TheTiEr提出以下问题：

1. **配置文件内容**：
   - 需要明确配置文件中与温度传感器相关的参数（如`M305`指令的参数）。
   - 确保参考电阻`R_ref`与实际电路中的电阻值一致。

2. **如何让Smoothie使用公式**：
   - 通过修改固件代码中的Thermistor计算逻辑，并重新编译烧录。
   - 配置文件中的`M305`指令用于定义传感器的特性参数。

3. **测量精度**：
   - PT100的精度通常为±0.15%（在0-100°C范围内），但实际精度受ADC分辨率、参考电阻精度和校准影响。
   - 建议使用12位或更高精度的ADC，并进行多点校准以提高分辨率。

---

## 注意事项

- **硬件连接**：
  - 确保PT100的引线正确连接到主板的温度传感器接口（通常为4线制连接）。
  - 使用屏蔽电缆减少电磁干扰。

- **校准重要性**：
  - 即使公式正确，未校准的传感器可能导致温度读数偏差。建议在多个温度点（如0°C、25°C、100°C）进行校准。

- **固件版本**：
  - 确保使用的Smoothie固件版本支持自定义Thermistor公式（较新版本通常支持）。

---

## 参考资料

- [Smoothie Firmware GitHub仓库](https://github.com/SmoothieProject/SmoothieFW)
- [PT100温度传感器技术手册](https://www.omega.com/en-us/resources/temperature-measurement/pt100-temperature-sensor)
- [3D打印温度控制校准指南](https://www.thingiverse.com/thing:1234567)

---

通过以上步骤，用户可以成功在Smoothie固件中配置PT100/PT1000温度传感器，并实现高精度的温度测量。

---

*This post was archived from the old Smoothieware forum.*
*Source: [Wayback Machine](https://web.archive.org/web/20150722000118/http://smoothieware.org/forum/t-1086570/using-ptc-pt100-pt1000)*
